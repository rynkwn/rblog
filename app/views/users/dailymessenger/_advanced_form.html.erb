<h2 class="text-left">What is this?</h2>

<p>
  This section lets you further customize the filtering options available.
  The filtering process has three major components:
</p>

<ul>
  <li><p>Key Words: If a message contains one of these words, pass it through the filter.</p></li>
  <li><p>Antiwords: If a message contains one of these words, reject it. Even if it contains a keyword</p></li>
  <li><p>Category: A specific part of the Daily Messages we look at.</p></li>
</ul>

# Keys will be shared, and will denote topic/heading.
    # Note. Each column below is internally represented and used as a hash.
    add_column :service_dailies, :adv_keywords, :text
    add_column :service_dailies, :adv_senders, :text
    add_column :service_dailies, :adv_categories, :text

<%= form_for(@dm, html: {class: 'form', :autocomplete => "off"})do |f| %>
  <div class="form-group">
    
    <br>
    
    <%= hidden_field_tag :option, "advanced" %>
    
    <%= f.label :key_words, "What topics are you interested in? (Separate by commas)"%>
    
    <!-- Check to see if the user has any defined advanced keys -->
    <% keys = DAILY_MESSENGER_KEYWORDS.keys + DAILY_MESSENGER_SENDERS.keys %>
    
    <table>
      <% keys.each do |key| %>
        <tr>
            <td><%= check_box_tag "words[]", key, checked = Arrayutils::include?(@dm.key_words, key) %></td>
            <td class="text-left bold"><%= key %></td>
            <td></td>
        </tr>
        
        <!-- Keyword specification -->
        <tr>
          <td></td>
          <td>Keywords to filter for:</td>
          <td></td>
        </tr>
        
        <tr>
          <td colspan="3"><%= text_field_tag "advkeys[]", grab_keyword_or_sender_values(key), placeholder: 'Enter keywords to filter for', size: 40 %></td>
        </tr>
        
        <!-- Anti-keywords -->
        <tr>
          <td></td>
          <td>When we see any of these words, we ALWAYS reject the message</td>
          <td></td>
        </tr>
        
        <tr>
          <td colspan="3"><%= text_field_tag "antiwords[]", grab_antiword_values(key), placeholder: 'Enter antiwords to filter for', size: 40 %> </td>
        </tr>
        
        <!-- Categories -->
        <tr>
          <td></td>
          <td>What categories should we check? (If you're not sure what a category is, see explanation below)</td>
          <td></td>
        </tr>
        
        <tr>
          <td colspan="3"><%= text_field_tag "categories[]", grab_antiword_values(key), placeholder: 'Enter antiwords to filter for', size: 40 %> </td>
        </tr>
        
        <!-- 2 empty rows for spacing -->
        <tr><td></td></tr>
        <tr><td></td></tr>
      <% end %>
    </table>
    
    <%= f.label 'What groups do you always want to receive daily messages from?' %>
    
    <table class="center">
      <% DAILY_MESSENGER_SENDERS.keys.in_groups_of(2, '&nbsp;') {|group| %>
        <tr>
            <td><%= check_box_tag "senders[]", group[0], checked = Arrayutils::include?(@dm.sender, group[0]) %></td>
            <td class="text-left"><%= group[0] %></td>
            
            <% if group[1] == '&nbsp;' %>
              <td> </td>
              <td> </td>
            <% else %>
              <td><%= check_box_tag "senders[]", group[1], checked = Arrayutils::include?(@dm.sender, group[1]) %></td>
            <td class="text-left"><%= group[1] %></td>
            <% end %>
        </tr>
      <% } %>
    </table>
    
  </div>
  
<div class="center">
  <%= f.submit "Save!", class: "btn-primary btn-lg" %>
</div>
  
<% end %>